<html>

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="Access-Control-Allow-Origin" content="192.168.153.128">
    <meta http-equiv="Access-Control-Allow-Methods" content="POST,GET">
	<script type="text/javascript" src="javascripts/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="javascripts/json_rpc.js"></script>
<script>

function set_fun(name, fun){
    var tc = 'fun';
    if(fun.params.length > 0)
        tc = 'funs';
    //var ret = '<form action="/" name="' + name + '" onsubmit="return on_submit(this);"> <table class="' + tc + '">';
    var ret = '<form action="/" name="' + name + '" onsubmit="return on_submit(this);"> <table class="' + tc + '">';

    for(var i=0;i<fun.params.length ;i++ ){
        var reminder = typeof(fun.params[i]);
        var text = fun.params[i];

        console.log('fun.params=', fun.params, ',typeof(fun.params[i]=', typeof(fun.params[i]));
        if(typeof(fun.params[i]) == "string")
            ret += '<tr><td> <input class="input" name="' + reminder + '" type="text"></td></tr>';
        else
            ret += '<tr><td> <input class="input" name="' + reminder + '" type="checkbox"></td></tr>';
    }

    var funname = name;
    ret += '<tr> <td> <input type="submit" id="submitName" value="'  + funname + '">  </td></tr></table></form>';
    return ret;
}

function set_funs() {
    var funs = rpc_funs();

    var html = '';
    for(var value in funs) {
        html += set_fun(value, funs[value]);
    }

    $("#funs").html(html);
}

function onDeviceReady() {
	console.log('list:window.parent=', window.parent, ",window.parent.url_key()=", window.parent.url_key());
    set_funs();
    window.parent.rpccall();
	return;
	var strKey = "url_array"; 
	var storage = window.localStorage; 
	var value = storage.getItem(strKey);
	
	console.log('value=', value, '$("#text_host")=', $("#text_host"));
	if(value==null)
		return;
		
	var strs= value.split(",");
	var select = document.getElementById("url_list"); 
	for(var i=0;i<strs.length ;i++ ){
		if(strs[i].length > 0){
			if(i == 0){
				set_url(strs[i]);
				inserted = true;
			}
			url_array.push(strs[i]);
			select.add(new Option(strs[i],""));
		}
	}
}

function on_submit(obj){
    var name = $(obj)[0].name;
    var params = [];
    var arr = $(obj).find(".input");

    for(var i=0; i< arr.length; i++){
        console.log("name=", name, ",arr[i].name=", arr[i].name);
        if(arr[i].name == "boolean"){
            params[i] = arr[i].checked;
        }else{
            params[i] = arr[i].value;
        }
    }

    console.log("name=", name, ",params=", params);
    window.parent.json_rpc(name, params, function (err, result) {
        if(err){
            $("#result_text").text(result);
            return;
        }
        console.log('err=', err, 'result=', result);

        result = JSON.parse(result);
        result = result.result;
        if(typeof(rpc_ret(name)) == 'object'){
            result = JSON.stringify(result, null, 4);
        }
        $("#result_text").text(result);
    })

    return false;
}

function on_submit11(obj)
{
	var arr = $(obj).children("input");
	var arg = '';
	var fun = $(obj)[0].name;
	var type = $(obj)[0].className;
	
	for(var i=0;i<arr.length;i++){
		if(arr[i].type == 'submit')
			continue;
		
		var value = arr[i].value;
		//console.log('value=', value, 'arg=', arg, ',arr=', arr);
		if(value == null || 0 == value.length)
			value = '""';
		else
			value = '"' + value + '"';
			
		if(arg.length){
			arg = arg + ',' + value;
		}else{
			arg = value;
		}
	}

	console.log('fun=', fun, 'arg=', arg, 'type=', type);
	window.parent.ajax('/web3/', 
		{"fun":fun,"arg":arg,"type":type},
		function(XMLHttpRequest, textStatus){
			var result = JSON.stringify(JSON.parse(XMLHttpRequest.responseText), null, 4);
            $("#result_text").text(result);  
        }
	);

	return false;
}

</script>

<style type="text/css">
	html
	{
	 height:100%;
	 margin:0;
	}
	body
	{
		height:99%;
		margin:0; 
	}
	
	hr{ border-top:1px solid #987cb9;}
	
	.left{ width:38%; float:left;border:1px solid green;height:100%;}
	.right{ width:60%; margin-left:38%;border:1px solid orange;height:100%;}

    table.funs {border:1px solid #666666}
    input[name="string"] {width:400px;}

    #result_text {
    width: 100%; /*自动适应父布局宽度*/  
	height: 100%;
    overflow: auto;  
    word-break: break-all;  
    /*在ie中解决断行问题(防止自动变为在一行显示，主要解决ie兼容问题，ie8中当设宽度为100%时，文本域类容超过一行时，当我们双击文本内容就会自动变为一行显示，所以只能用ie的专有断行属性“word-break或word-wrap”控制其断行)*/  
	} 
</style>

</head>

<body>
<div align="center">

<div class="w">
	<div class="left"><div align="left">

    <div id="funs"></div>
<!--
	<form action="/web3/" class="fun" method="get" name="getPeers"  onsubmit="return on_submit(this);">
		<input type="submit" name="submit" value="getPeers"/>
    </form>
-->                            
    </div></div>
    <div class="right"><textarea id="result_text"></textarea></div>
    
</div>


</div>

<script type="text/javascript">
$(document).ready(function(){
	onDeviceReady();
});

</script>
</body>

</html>